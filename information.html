<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Redeemerâ€™s Profile Setup</title>

<style>
    body{background:#0d1126;color:white;font-family:poppins;margin:0;padding:20px;text-align:center;}
    .card{
        width:410px;margin:auto;background:#12182f;padding:25px;border-radius:12px;
        box-shadow:0 0 20px rgba(0,255,255,.2);
    }
    h2{color:#00eaff;margin-bottom:12px;}

    select,input,textarea{
        width:95%;margin-top:10px;padding:10px;background:#1a2548;border:1px solid #00eaff;
        border-radius:6px;color:white;
    }
    button{
        width:95%;margin-top:18px;padding:12px;background:#00eaff;color:black;font-weight:600;
        border:none;border-radius:6px;font-size:16px;cursor:pointer;transition:.3s;
    }
    button:hover{background:#11ffee;}
    
    /* Upload Animation Box */
    #uploadStatus{
        display:none;margin-top:12px;padding:12px;border-radius:6px;font-size:15px;
        animation:fadeIn .5s;
    }
    @keyframes fadeIn{0%{opacity:0}100%{opacity:1}}

    /* Success Flash */
    .successGlow{
        animation:glow .8s ease-out 1;
    }
    @keyframes glow{
        0%{box-shadow:0 0 0px #00ffbf;}
        50%{box-shadow:0 0 25px #00ffbf;}
        100%{box-shadow:0 0 5px #00ffbf;}
    }
</style>
</head>

<body>
<div class="card" id="formCard">
    <h2>Complete Your Profile</h2>

    <input id="name" placeholder="Full Name">

    <!-- AGE DROPDOWN -->
    <select id="age">
        <option value="">Select Age</option>
        <script>
            for(let i=15;i<=40;i++)document.write(`<option>${i}</option>`);
        </script>
    </select>

    <input id="complexion" placeholder="Complexion">


    <!-- ðŸ”¥ FULL FACULTY + AUTOMATIC DEPARTMENTS -->
    <select id="faculty" onchange="loadDepartments()">
        <option value="">Select Faculty</option>
        <option value="Engineering">Engineering</option>
        <option value="Law">Law</option>
        <option value="Management Sciences">Management Sciences</option>
        <option value="Natural Sciences">Natural Sciences</option>
        <option value="Social Sciences">Social Sciences</option>
        <option value="Humanities">Humanities</option>
        <option value="Basic Medical Sciences">Basic Medical Sciences</option>
        <option value="Environmental Sciences">Environmental Sciences</option>
    </select>

    <select id="department">
        <option value="">Select Department</option>
    </select>


    <textarea id="about" placeholder="Write about yourself..." rows="4"></textarea>

    <label>Upload Profile Picture</label>
    <input type="file" id="profilePic" accept="image/*">

    <div id="uploadStatus"></div>

    <button id="saveBtn">Save Profile</button>
</div>



<!--------- FIREBASE + IMGBB ---------->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

const app = initializeApp({
    apiKey:"AIzaSyAXZQi1Wdwf7oHRVapWNGgcCYtd4Dy5kQk",
    authDomain:"eren-c4b30.firebaseapp.com",
    projectId:"eren-c4b30"
});
const auth=getAuth(app);const db=getFirestore(app);


/* ðŸ”¥ Faculty â†’ Department Auto Loader */
const departmentData={
    "Engineering":[ "Electrical", "Mechanical","Civil","Computer Engineering","Software Engineering" ],
    "Law":[ "Constitutional Law","Business & Corporate Law","International Law" ],
    "Management Sciences":[ "Accounting","Business Admin","Finance","Marketing" ],
    "Natural Sciences":[ "Computer Science","Microbiology","Biochemistry","Chemistry","Physics" ],
    "Social Sciences":[ "Mass Communication","Economics","Political Science","Psychology" ],
    "Humanities":[ "History","Linguistics","Philosophy","Religious Studies" ],
    "Basic Medical Sciences":[ "Nursing","Anatomy","Physiology","Medical Laboratory Science" ],
    "Environmental Sciences":[ "Architecture","Estate Management","Urban Planning" ]
};

window.loadDepartments=()=>{
    const fac=document.getElementById("faculty").value;
    const dep=document.getElementById("department");
    dep.innerHTML="<option>Select Department</option>";
    if(departmentData[fac]){
        departmentData[fac].forEach(d=>{
            dep.innerHTML+=`<option>${d}</option>`;
        });
    }
};



/* ðŸ”¥ IMGBB Upload */
async function uploadToImgBB(file){
    let box=document.getElementById("uploadStatus");
    box.style.display="block";
    box.innerHTML="â³ Uploading picture...";

    const form=new FormData();
    form.append("image",file);

    const res = await fetch("https://api.imgbb.com/1/upload?key=efd9e3255bb9ff4053c312897dd157c7",{
        method:"POST",
        body:form
    });

    const data=await res.json();

    box.innerHTML="âœ” Upload Complete!";
    document.getElementById("formCard").classList.add("successGlow");

    return data.data.url;
}



/* ðŸ”¥ SAVE PROFILE */
document.getElementById("saveBtn").onclick=async()=>{

    const user=auth.currentUser;
    if(!user) return alert("Login first!");

    const pic=document.getElementById("profilePic").files[0];
    if(!pic) return alert("Select profile picture!");

    const imageURL=await uploadToImgBB(pic);

    await setDoc(doc(db,"students",user.uid),{
        name:document.getElementById("name").value,
        age:document.getElementById("age").value,
        complexion:document.getElementById("complexion").value,
        faculty:document.getElementById("faculty").value,
        department:document.getElementById("department").value,
        about:document.getElementById("about").value,
        profilePic:imageURL,
        email:user.email
    });

    alert("ðŸŽ‰ Profile Saved Successfully");
    location.href="directory.html"; // move next
}
/* âš  Prevent already registered users from seeing this page */
import { getDoc, doc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

auth.onAuthStateChanged(async(user)=>{
    if(!user) return; // not logged in

    const ref = doc(db,"students",user.uid);
    const snap = await getDoc(ref);

    if(snap.exists()){ 
        // Profile already created
        alert("Welcome back " + snap.data().name);
        window.location.href="directory.html"; // ðŸ”¥ redirect
    }
});

</script>

</body>
</html>
