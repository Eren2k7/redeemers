<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chats</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="logo.fw.jpeg">
<style>
body{background:#0b141a;font-family:sans-serif;color:white;margin:0;}
header{background:#075E54;padding:12px;text-align:center;font-size:20px;}
.chat-item{
  display:flex;align-items:center;gap:10px;
  background:#111b21;padding:12px;margin:4px;
  border-radius:10px;cursor:pointer;
}
.chat-item img{
  width:45px;height:45px;border-radius:50%;
  border:2px solid #0CC3A3;object-fit:cover;
}
.chat-item:hover{background:#1b2731;}
</style>
</head>
<body>

<header>Your Chats ðŸ“©</header>
<div id="chatList"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, getDoc } 
  from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

const app=initializeApp({apiKey:"AIzaSyAXZQi1Wdwf7oHRVapWNGgcCYtd4Dy5kQk",authDomain:"eren-c4b30.firebaseapp.com",projectId:"eren-c4b30"});
const auth=getAuth(app);const db=getFirestore(app);

auth.onAuthStateChanged(async(user)=>{
  if(!user) return alert("Login first");

  const chatsSnap = await getDocs(collection(db,"chats"));
  const box=document.getElementById("chatList");

  for(const chatDoc of chatsSnap.docs){
    const data=chatDoc.data();
    if(data.users.includes(user.uid)){
      
      const other=data.users.filter(id=>id!==user.uid)[0];
      const snap=await getDoc(doc(db,"students",other));
      if(!snap.exists()) continue;
      const u=snap.data();

      box.innerHTML+=`
        <div class="chat-item" onclick="window.location.href='chat.html?user=${other}'">
          <img src="${u.profilePic}">
          <div><b>${u.name}</b><br><span style="opacity:.6;font-size:12px;">${u.department}</span></div>
        </div>
      `;
    }
  }
});
</script>
</body>
</html>
