<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Student Directory</title>

<style>
    body{
        background:#0d1126;
        font-family:poppins;
        color:white;
        text-align:center;
        margin:0; padding:20px;
    }
    h2{color:#00eaff;margin-bottom:15px;}

    select{
        background:#14203e;border:1px solid #00eaff;color:white;
        padding:10px;border-radius:6px;margin:5px;width:180px;
    }

    .grid{
        margin-top:25px;
        display:grid;
        grid-template-columns:repeat(auto-fit,200px);
        gap:22px;justify-content:center;
    }

    .card{
        background:#12182f;padding:12px;border-radius:10px;
        box-shadow:0 0 12px rgba(0,255,255,.18);
        cursor:pointer;transition:.3s;
    }
    .card:hover{transform:scale(1.05);box-shadow:0 0 25px rgba(0,255,255,.45);}
    img{width:100%;height:180px;object-fit:cover;border-radius:8px;}
    .name{font-size:17px;font-weight:600;margin-top:8px;color:#00eaff;}
    .dept{font-size:13px;color:#9cdcff;}
</style>
</head>

<body>

<h2>Redeemer's Student Directory</h2>

<!-- ðŸ”¥ Filter System -->
<select id="filterFaculty" onchange="filterStudents()">
    <option value="">All Faculties</option>
    <option>Engineering</option>
    <option>Law</option>
    <option>Management Sciences</option>
    <option>Natural Sciences</option>
    <option>Social Sciences</option>
    <option>Humanities</option>
    <option>Basic Medical Sciences</option>
    <option>Environmental Sciences</option>
</select>

<select id="filterDepartment" onchange="filterStudents()">
    <option value="">All Departments</option>
</select>

<div class="grid" id="studentGrid"></div>



<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

const app = initializeApp({
    apiKey:"AIzaSyAXZQi1Wdwf7oHRVapWNGgcCYtd4Dy5kQk",
    authDomain:"eren-c4b30.firebaseapp.com",
    projectId:"eren-c4b30"
});
const db = getFirestore(app);


let allStudents = [];


/* Load students from Firestore */
async function loadStudents(){
    const snap = await getDocs(collection(db,"students"));
    snap.forEach(doc => allStudents.push({uid:doc.id, ...doc.data()}));
    displayStudents(allStudents);
    loadDepartmentsDropdown();
}


/* Display on page */
function displayStudents(list){
    const grid=document.getElementById("studentGrid");
    grid.innerHTML="";

    list.forEach(s=>{
        grid.innerHTML+=`
        <div class="card" onclick="openProfile('${s.uid}')">
            <img src="${s.profilePic}">
            <div class="name">${s.name}</div>
            <div class="dept">${s.department} - ${s.faculty}</div>
        </div>`;
    });
}


/* Open user profile */
window.openProfile=(uid)=>{
    location.href="profile-view.html?uid="+uid;
}



/* Filter & Update */
function filterStudents(){
    const fac=document.getElementById("filterFaculty").value;
    const dep=document.getElementById("filterDepartment").value;

    let filtered=allStudents.filter(s=>
        (fac==="" || s.faculty===fac) &&
        (dep==="" || s.department===dep)
    );

    displayStudents(filtered);
}


/* Auto department dropdown from DB */
function loadDepartmentsDropdown(){
    const unique = [...new Set(allStudents.map(s=>s.department))];
    const select=document.getElementById("filterDepartment");
    unique.forEach(d => select.innerHTML += `<option>${d}</option>`);
}


loadStudents();
</script>

</body>
</html>
